<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Wordle.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">wordle</a> &gt; <a href="index.source.html" class="el_package">it.uniba.app</a> &gt; <span class="el_source">Wordle.java</span></div><h1>Wordle.java</h1><pre class="source lang-java linenums">package it.uniba.app;


import java.util.Map;
import java.util.HashMap;

/**
 * {@literal &lt;&lt;Control&gt;&gt;} &lt;br&gt;
 * Classe che implementa la logica del gioco: opera su oggetti delle classi di tipo Entity,
 * coerentemente con le regole di Wordle. &lt;p&gt;&lt;/p&gt;
 * Fornisce una API (Application Programming Interface) indipendente dallo strato di User Interface,
 * il quale richiamerà i suoi servizi, effettuando controlli sulla legalità delle chiamate.
 */
<span class="nc" id="L14">public class Wordle</span>
{
<span class="nc" id="L16">    private static String secretWord = null;</span>
<span class="nc" id="L17">    private static WordleGame currentGame = null;</span>
<span class="nc" id="L18">    private static int nMaxGuesses = 6;</span>
<span class="nc" id="L19">    private static int wordLength = 5;</span>

    /**
     * Inizia una nuova partita a Wordle.
     *
     * @throws WordleGameException  se una partita è già in corso
     * @throws WordleSettingException   se la parola segreta non è impostata
     */
    public static void startGame() throws WordleGameException, WordleSettingException
    {
<span class="nc bnc" id="L29" title="All 2 branches missed.">        if (isGameRunning())</span>
<span class="nc" id="L30">            throw new WordleGameException(&quot;Partita in corso&quot;);</span>

<span class="nc bnc" id="L32" title="All 2 branches missed.">        if (secretWord == null)</span>
<span class="nc" id="L33">            throw new WordleSettingException(&quot;Parola segreta non impostata&quot;);</span>

<span class="nc" id="L35">        currentGame = new WordleGame(secretWord);</span>
<span class="nc" id="L36">    }</span>

    /**
     * Effettua un tentativo e lo inserisce nella matrice dei tentativi della partita corrente.&lt;br&gt;
     * Per ogni lettera della parola inserita colora lo sfondo (della casella corrispondente)
     * di verde se la lettera è nella parola segreta e nel posto giusto,
     * di giallo se la lettera è nella parola segreta ma nel posto sbagliato e
     * di grigio se la lettera non è nella parola segreta.
     *
     * @param guessWord stringa contenente la parola inserita dal giocatore
     * @throws WordleGameException  se nessuna partita è in corso o se è stato già raggiunto il numero massimo di tentativi
     * @throws IllegalArgumentException   se {@code guessWord} non soddisfa la lunghezza prevista o contiene caratteri non validi
     */
    public static void guess(String guessWord) throws WordleGameException, IllegalArgumentException
    {
<span class="nc bnc" id="L51" title="All 2 branches missed.">        if (!isGameRunning())</span>
<span class="nc" id="L52">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (getNumRemainingGuesses() == 0)</span>
<span class="nc" id="L55">            throw new WordleGameException(&quot;Numero massimo di tentativi raggiunto&quot;);</span>

        try
        {
<span class="nc" id="L59">            guessWordCheck(guessWord);</span>
        }
<span class="nc" id="L61">        catch (IllegalArgumentException e)</span>
        {
<span class="nc" id="L63">            throw e;</span>
<span class="nc" id="L64">        }</span>

        //Inizializzazione tentativo
<span class="nc" id="L67">        guessWord = guessWord.toUpperCase();</span>
<span class="nc" id="L68">        String secretWord = currentGame.getSecretWord();</span>
<span class="nc" id="L69">        Guess newGuess = new Guess(guessWord);</span>
<span class="nc" id="L70">        Map&lt;Character, Integer&gt; letterMap = new HashMap&lt;&gt;(); //Conterrà le coppie (lettera, numOccorrenze) della secret</span>

        //Inserimento delle coppie nel dizionario
<span class="nc bnc" id="L73" title="All 2 branches missed.">        for(char letter : secretWord.toCharArray())</span>
        {
<span class="nc bnc" id="L75" title="All 2 branches missed.">            if(!letterMap.containsKey(letter))</span>
<span class="nc" id="L76">                letterMap.put(letter, 1);</span>
            else
<span class="nc" id="L78">                letterMap.put(letter, letterMap.get(letter) + 1);</span>
        }

        //Primo step: setting delle lettere verdi
<span class="nc bnc" id="L82" title="All 2 branches missed.">        for(int i = 0; i &lt; guessWord.length(); i++)</span>
        {
<span class="nc" id="L84">            char l = guessWord.charAt(i);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">            if(l == secretWord.charAt(i))</span>
            {
<span class="nc" id="L87">                newGuess.setColor(i, Color.GREEN);</span>

                //decrementa dizionario
<span class="nc" id="L90">                letterMap.put(l, letterMap.get(l) - 1);</span>
            }
        }

        //Secondo step: setting delle lettere gialle e grigie
        Guess.LetterBox lb;
<span class="nc bnc" id="L96" title="All 2 branches missed.">        for(int i = 0; i &lt; guessWord.length(); i++)</span>
        {
<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (newGuess.getColor(i) == Color.GREEN)</span>
<span class="nc" id="L99">                continue;</span>

<span class="nc" id="L101">            char l = guessWord.charAt(i);</span>
<span class="nc bnc" id="L102" title="All 4 branches missed.">            if(letterMap.containsKey(l) &amp;&amp; letterMap.get(l) &gt; 0) //test YELLOW</span>
            {
<span class="nc" id="L104">                newGuess.setColor(i, Color.YELLOW);</span>
<span class="nc" id="L105">                letterMap.put(l, letterMap.get(l) - 1);</span>
            }
            else
<span class="nc" id="L108">                newGuess.setColor(i, Color.GREY);</span>
        }

        // aggiungi il tentativo alla matrice dei tentativi
<span class="nc" id="L112">        Board gameBoard = currentGame.getGameBoard();</span>
<span class="nc" id="L113">        gameBoard.acceptNewGuess(newGuess);</span>
<span class="nc" id="L114">    }</span>

    /**
     * Restituisce il risultato dell'ultimo tentativo effettuato.
     * @throws WordleGameException  se nessuna partita è in corso
     * @return true se il tentativo è vincente, false se non è vincente
     * oppure se non sono stati effettuati tentativi nella partita corrente
     */
    public static boolean getGuessResult()
    {
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L125">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L127">        Board currentBoard = currentGame.getGameBoard();</span>
<span class="nc" id="L128">        int lastGuessIndex = currentBoard.getNumFilledRows()-1;</span>

<span class="nc bnc" id="L130" title="All 2 branches missed.">        if(lastGuessIndex == -1)</span>
<span class="nc" id="L131">            return false;</span>
        else
        {
<span class="nc" id="L134">            String currentWord = currentBoard.getGuess(lastGuessIndex).getWord();</span>
<span class="nc" id="L135">            return currentWord.equals(currentGame.getSecretWord());</span>
        }
    }

    /**
     * Restituisce il numero di tentativi rimanenti per la partita corrente.
     * @throws WordleGameException  se nessuna partita è in corso
     */
    public static int getNumRemainingGuesses()
    {
<span class="nc bnc" id="L145" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L146">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L148">        return currentGame.getNumRemainingGuesses();</span>
    }

    /**
     * Restituisce il numero totale di tentativi per la partita corrente.
     * @throws WordleGameException  se nessuna partita è in corso
     */
    public static int getMaxGuesses()
    {
<span class="nc bnc" id="L157" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L158">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L160">        return currentGame.getMaxGuesses();</span>
    }

    /**
     * Restituisce la lunghezza della parola segreta.
     * @throws WordleGameException  se nessuna partita è in corso
     */
    public static int getWordLength()
    {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L170">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L172">        return currentGame.getWordLength();</span>
    }

    /**
     * Restituisce la lettera contenuta in una casella della matrice dei tentativi della partita corrente.
     * @param row   il valore 0 indica la prima riga, il valore i-esimo indica la riga i+1,
     *              il valore massimo corrisponde al numero di righe della matrice dei tentativi - 1
     * @param column    il valore 0 indica la prima colonna, il valore i-esimo indica la colonna i+1,
     *                  il valore massimo corrisponde al numero di colonne della matrice dei tentativi - 1
     * @return  la lettera nella casella alla riga {@code row} e alla colonna {@code column} se il tentativo
     * corrispondente alla riga {@code row} è stato effettuato, ' ' altrimenti
     * @throws WordleGameException   se nessuna partita è in corso
     * @throws  IllegalArgumentException se {@code row} o {@code column} eccedono le dimensioni della matrice dei tentativi
     * oppure sono numeri negativi
     */
    public static char getLetter(int row, int column)
    {
<span class="nc bnc" id="L189" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L190">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L192">        Board currentBoard = currentGame.getGameBoard();</span>
<span class="nc bnc" id="L193" title="All 8 branches missed.">        if (row &lt; 0 || column &lt; 0 || row &gt;= currentBoard.getRowsNumber() || column &gt;= currentBoard.getWordLength())</span>
<span class="nc" id="L194">            throw new IllegalArgumentException();</span>

<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (row &gt;= currentBoard.getNumFilledRows())</span>
<span class="nc" id="L197">            return ' ';</span>
        else
<span class="nc" id="L199">            return currentBoard.getGuess(row).getLetter(column);</span>
    }

    /**
     * Restituisce il colore di una casella della matrice dei tentativi della partita corrente.
     * @param row   il valore 0 indica la prima riga, il valore i-esimo indica la riga i+1,
     *              il valore massimo corrisponde al numero di righe della matrice dei tentativi - 1
     * @param column    il valore 0 indica la prima colonna, il valore i-esimo indica la colonna i+1,
     *                  il valore massimo corrisponde al numero di colonne della matrice dei tentativi - 1
     * @return  il colore della casella alla riga {@code row} e alla colonna {@code column} se il tentativo
     * corrispondente alla riga {@code row} è stato effettuato, {@code NO_COLOR} altrimenti
     * @throws WordleGameException   se nessuna partita è in corso
     * @throws  IllegalArgumentException se {@code row} o {@code column} eccedono le dimensioni della matrice dei tentativi
     * oppure sono numeri negativi
     */
    public static Color getColor(int row, int column)
    {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L217">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L219">        Board currentBoard = currentGame.getGameBoard();</span>
<span class="nc bnc" id="L220" title="All 8 branches missed.">        if (row &lt; 0 || column &lt; 0 || row &gt;= currentBoard.getRowsNumber() || column &gt;= currentBoard.getWordLength())</span>
<span class="nc" id="L221">            throw new IllegalArgumentException();</span>

<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (row &gt;= currentBoard.getNumFilledRows())</span>
<span class="nc" id="L224">            return Color.NO_COLOR;</span>
        else
<span class="nc" id="L226">            return currentBoard.getGuess(row).getColor(column);</span>
    }

    /**
     * Termina la partita in corso.
     * @throws WordleGameException se nessuna partita è in corso
     */
    public static void endGame() throws WordleGameException
    {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if(!isGameRunning())</span>
<span class="nc" id="L236">            throw new WordleGameException(&quot;Nessuna partita in corso&quot;);</span>

<span class="nc" id="L238">        currentGame = null;</span>
<span class="nc" id="L239">    }</span>

    /**
     * Imposta la parola segreta.
     * @param newWord   parola segreta da impostare
     * @throws IllegalArgumentException se {@code newWord} non soddisfa la lunghezza prevista o contiene caratteri non validi
     * @throws WordleGameException  se una partita è già in corso
     */
    public static void setSecretWord(String newWord) throws IllegalArgumentException, WordleGameException
    {
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (!newWord.matches(&quot;[a-zA-Z]+&quot;))</span>
<span class="nc" id="L250">            throw new IllegalArgumentException(&quot;Parola segreta non valida&quot;);</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (newWord.length() &lt; wordLength)</span>
<span class="nc" id="L253">            throw new IllegalArgumentException(&quot;Parola segreta troppo corta&quot;);</span>

<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (newWord.length() &gt; wordLength)</span>
<span class="nc" id="L256">            throw new IllegalArgumentException(&quot;Parola segreta troppo lunga&quot;);</span>

<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (isGameRunning())</span>
<span class="nc" id="L259">            throw new WordleGameException(&quot;Partita in corso&quot;);</span>

<span class="nc" id="L261">        secretWord = newWord.toUpperCase();</span>
<span class="nc" id="L262">    }</span>

    /**
     * @return true se è in corso una partita, false altrimenti
     */
    public static boolean isGameRunning()
    {
<span class="nc bnc" id="L269" title="All 2 branches missed.">        return currentGame != null;</span>
    }

    private static void guessWordCheck(String word) throws IllegalArgumentException
    {
<span class="nc bnc" id="L274" title="All 2 branches missed.">        if (!word.matches(&quot;[a-zA-Z]+&quot;))</span>
<span class="nc" id="L275">            throw new IllegalArgumentException(&quot;Tentativo non valido&quot;);</span>

<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (word.length() &lt; wordLength)</span>
<span class="nc" id="L278">            throw new IllegalArgumentException(&quot;Tentantivo incompleto&quot;);</span>

<span class="nc bnc" id="L280" title="All 2 branches missed.">        if (word.length() &gt; wordLength)</span>
<span class="nc" id="L281">            throw new IllegalArgumentException(&quot;Tentativo eccessivo&quot;);</span>
<span class="nc" id="L282">    }</span>

    /**
     * Restituisce la parola segreta dalle impostazioni di gioco.&lt;p&gt;&lt;/p&gt;
     * Nota: questo metodo, molto simile a {@link Wordle#getGameSecretWord()}, si differenzia da esso per
     * l'origine del dato restituito (la differenza risiede nel recuperare l'impostazione attuale sulla
     * parola segreta piuttosto che recuperare la parola segreta della partita già iniziata).&lt;br&gt;
     * La scelta di tenere separati i due metodi è stata presa in quanto il nostro team ritiene che favorisca
     * la modificabilità del codice.
     * @throws WordleSettingException  se la parola segreta non è stata impostata
     */
    public static String getSecretWord() throws WordleSettingException
    {
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (secretWord == null)</span>
<span class="nc" id="L296">            throw new WordleSettingException(&quot;Parola segreta non impostata&quot;);</span>

<span class="nc" id="L298">        return secretWord;</span>
    }

    /**
     * Restituisce la parola segreta per la partita corrente.
     * @throws WordleGameException  se nessuna partita è in corso
     */
    public static String getGameSecretWord() throws WordleGameException
    {
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (!isGameRunning())</span>
<span class="nc" id="L308">            throw new WordleGameException(&quot;Partita inesistente&quot;);</span>

<span class="nc" id="L310">        return currentGame.getSecretWord();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>